{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/foreground.css' %}">
  <link rel="icon" href="{% static 'image/binarylife.ico' %}" type="image/x-icon"/>
  <title>{% block title %}JEDORE'S BLOG{% endblock %}</title>
  {% block head %}{% endblock %}
</head>
<body>
<nav class="navbar bg-dark navbar-expand-lg">
  <a href="/">
    <span class="navbar-brand text-light" style="font-size: 25px; font-weight: 700;">JEDORE CBC</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse ml-5" id="navbarSupportedContent">
    {#      <ul id="nav-type" class="navbar-nav mr-auto">#}
    {#        {% for article_type in article_types %}#}
    {#          <li class="nav-item">#}
    {#            <a class="nav-link position-relative text-white {% if 'type_articles' in request.path and article_type.id|stringformat:"s" in request.path %}active{% endif %}"#}
    {#               href="/foreground/type_articles/{{ article_type.id }}">{{ article_type.name }}</a>#}
    {#          </li>#}
    {#        {% endfor %}#}
    {#      </ul>#}
    <ul class="navbar-nav ml-auto">
      {% if request.user.is_active %}
        <li id="profile" class="nav-item dropdown">
          <button type="button" class="btn btn-dark dropdown-toggle pl-4 pr-4" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false"><i class="fa fa-user"></i> {{ request.user }}
          </button>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item position-relative" href="/background">
              <i class="fa fa-inbox"></i> background
            </a>
            <a class="dropdown-item position-relative" href="/background/publish">
              <i class="fa fa-paper-plane"></i> publish
            </a>
            <a class="dropdown-item position-relative" href="/logout">
              <i class="fa fa-sign-out"></i> log out
            </a>
          </div>
        </li>
      {% else %}
        <li class="nav-item">
          <button class="btn btn-dark" data-toggle="modal" data-target="#loginModal">LOGIN
          </button>
        </li>
      {% endif %}
    </ul>
  </div>
</nav>
<div class="container mt-5">
  <div class="row">
    <div class="col-9">
      {% block content %}{% endblock %}
    </div>
    <div class="col-3">
      <div id="card-me" class="card mb-1">
        {#        <img class="card-img-top" src="..." alt="Card image cap">#}
        <div class="card-body">
          <h5 class="card-title">ABOUT ME</h5>
          <i class="card-text">Record something on way to ...</i>
          {#          <a href="#" class="btn btn-primary">Go somewhere</a>#}
        </div>
      </div>
      {#      <div id="card-types" class="card" style="width: 18rem;">#}
      {#        <img class="card-img-top" src="..." alt="Card image cap">#}
      {#        <div class="card-body">#}
      {#          <h5 class="card-title">CATEGORY</h5>#}
      {#          {% for type in types %}#}
      {#            <a href="{% url 'foreground:type_articles' type.id %}"#}
      {#               class="btn btn-sm btn-outline-dark text-left w-100 mb-1"> {{ type.name }}#}
      {#              {% if type.articles.count %}#}
      {#                <span class="badge badge-secondary"> {{ type.articles.count }}</span>#}
      {#              {% endif %}#}
      {#            </a>#}
      {#          {% endfor %}#}
      {#        </div>#}
      {#      </div>#}
      <div id="card-tags" class="card mb-1">
        {#        <img class="card-img-top" src="..." alt="Card image cap">#}
        <div class="card-body">
          <h5 class="card-title">TAG</h5>
          {% for tag in tags %}
            <a href="{% url 'foreground:tag_articles' tag.id %}" class="btn btn-sm btn-outline-dark mb-1">{{ tag.name }}
              {% if tag.articles.count %}
                <span class="badge badge-secondary">{{ tag.articles.count }}</span>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </div>
      <div id="card-comments" class="card">
        {#        <img class="card-img-top" src="..." alt="Card image cap">#}
        <div class="card-body">
          {% if comments %}
            <h5 class="card-title">RECENT COMMENTS</h5>
          {% endif %}
        </div>
        <ul class="list-group list-group-flush">
          {% for comment in comments %}
            {#              <a class="btn btn-sm btn-outline-dark text-left mb-1 w-100">#}
            <a class="list-group-item comment-link"
               href="{% url 'foreground:article' comment.article.id %} }/#comments">
              {{ comment.comment|slice:":30" }}
            </a>
            {#                {% if comment.comment|length > 20 %}...{% endif %}</a>#}
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content bg-light">
      <div class="modal-body">
        <form>
          <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
          <div class="form-group">
            <input type="text" class="form-control border-secondary" id="username" name="username"
                   placeholder="username">
          </div>
          <div class="form-group">
            <input type="password" class="form-control border-secondary" id="password" name="password"
                   placeholder="password">
          </div>
          <p id="error" class="text-center" style="color: red;"></p>
          <button id="login-click" type="button" class="btn btn-outline-secondary w-100">LOGIN</button>
        </form>
      </div>
    </div>
  </div>
</div>
{#<div class="footer sticky-bottom bg-dark p-2">#}
{#  <div class="container-fluid text-center text-light">#}
{#    <span> &copy;2018</span>#}
{#    <span> Jeodre CBC</span>#}
{#  </div>#}
{#</div>#}

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script src="https://cdn.bootcss.com/moment.js/2.20.1/moment.min.js"></script>
<script src="https://cdn.bootcss.com/moment-timezone/0.5.14/moment-timezone.min.js"></script>
<script src="https://cdn.bootcss.com/moment-timezone/0.5.14/moment-timezone-with-data.min.js"></script>
<script>
  function login_click() {
    $.ajax({
      type: "POST",
      url: {% url 'login' %},
      beforeSend: function (xhr, settings) {
        xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
      },
      cache: false,
      data: JSON.stringify({
        "username": $("#username").val(),
        "password": $("#password").val()
      }),
      contentType: "application/json; charset=utf-8",
      dataType: "json"
    }).done(function (data) {
      if (data['ret_code'] === 0) {
        window.location.href = window.location.href
      } else {
        $("#error").text(data['error']);
      }
    });
  }

  /*
  function resize_height() {
      var base_h = $("#article-list").height(),
          body_h = $(window).outerHeight(),
          footer_h = $("footer").height();
      //$("#index").css("min-height", base_h - footer_h > body_h -footer_h ? base_h : body_h);
      $("content").css("min-height", base_h > body_h ? base_h : body_h);
  }
  */

  $(function () {
    $("#login-click").click(function () {
      login_click();
    });
    /*resize_height();
    $(window).resize(function () {
        resize_height();
    });*/
  })
</script>
{% block script %}{% endblock %}
</body>
</html>

